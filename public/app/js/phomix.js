var Client=function(){this.handler=new Handler;this.open()};Client.prototype.showHeadStat=function(){};Client.prototype.showStat=function(a){$.popupMessage({message:a})};Client.prototype.showError=function(a){$.popupMessage({message:a})};
function disconnect(){var a=$(document).height()+50,d=$(window).width();$("body").append('<div id="blockView"/>');$("#blockView").addClass("disconnect").width(d+"px").height(a+"px").append("<table><tr><td>\u30b5\u30fc\u30d0\u30fc\u3068\u306e\u63a5\u7d9a\u304c\u5207\u65ad\u3055\u308c\u307e\u3057\u305f ...<br>\u5c11\u3057\u6642\u9593\u3092\u304a\u3044\u3066\u304b\u3089\u518d\u5ea6\u63a5\u7d9a\u3057\u3066\u304f\u3060\u3055\u3044</td></tr></table>")}
Client.prototype.open=function(){var a=this;a.showHeadStat("\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3057\u3066\u3044\u307e\u3059 "+location.host+"...");this.ws=io.connect("ws://"+location.host+"/",{port:3002});this.ws.on("connect",function(){a.showHeadStat("\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3057\u307e\u3057\u305f ["+location.host+"]");a.connected=!0;$("#blockView").remove();var d=$.cookie("accessToken");d&&App.client.send("login.autoLogin",{accessToken:d})});this.ws.on("connecting",
function(d){a.showHeadStat("\u63a5\u7d9a\u30bf\u30a4\u30d7 : "+d)});this.ws.on("connect_failed",function(){a.showHeadStat("\u30b5\u30fc\u30d0\u30fc\u3068\u306e\u63a5\u7d9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f")});this.ws.on("message",function(d){a.handler.invoke(d)});this.ws.on("close",function(){a.showHeadStat("\u30b5\u30fc\u30d0\u30fc\u3068\u306e\u63a5\u7d9a\u304c\u5207\u65ad\u3055\u308c\u307e\u3057\u305f");disconnect()});this.ws.on("disconnect",function(d){a.showHeadStat("Disconnect - "+d);
disconnect()});this.ws.on("reconnect",function(){a.showHeadStat("reconnect")});this.ws.on("reconnecting",function(){a.showHeadStat("reconnecting")});this.ws.on("reconnect_failed",function(){a.showHeadStat("reconnect_failed")})};Client.prototype.send=function(a,d){if(this.ws.socket.connected){var b=JSON.stringify(d);this.ws.send(a+":"+b)}else this.showError("\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u5207\u65ad\u3055\u308c\u3066\u3044\u307e\u3059")};var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-11964840-5"]);_gaq.push(["_trackPageview"]);
(function(a,d){var b={client:void 0,rollover:function(c){c=c||a("body");-1!=navigator.userAgent.indexOf("MSIE 8.")?c.find(".imgover").hover(function(){a(this).css("-ms-filter","progid:DXImageTransform.Microsoft.Alpha(Opacity=75)")},function(){a(this).css("-ms-filter","progid:DXImageTransform.Microsoft.Alpha(Opacity=100)")}):c.find(".imgover").hover(function(){a(this).fadeTo(100,0.75)},function(){a(this).fadeTo(100,1)})},openDialog:function(c,f,d){var e=a("#dialogBox");0<e.length&&e.remove();e=a(['<div id="dialogBox" class="window display-none">',
'<h2 class="caption">'+c+"</h2>",f,'<p class="close"><a href="#" class="icon icon-close imgover"></a></p></div>'].join(""));e.appendTo("body");a(".close",e).click(function(c){c.preventDefault();a.mLightBox.close()});b.rollover(e);a.mLightBox({mLightBoxId:"#dialogBox",callback:function(){d(e)},closecallback:function(){}})},closeDialog:function(){a.mLightBox.close()},textCounter:function(){a(".txtCounter").each(function(){var c=a(this),f=c.text();c.closest("div").find("input,textarea").charCount({allowed:f,
counterTarget:c,cssWarning:"text-red"})})},getImageUrl:function(c,f,b){c||a.popupMessage({message:["\u5f15\u6570\u4e0d\u6b63"]});var e="";f&&(e=f.suffix||"",""!==e&&(e="_"+e));f="";b&&(f=b.suffix||"",""!==f&&(f="_"+f));var b=c.substr(0,2),d=c.substr(2,2),h=c.substr(4,2);return"/img/thumb/"+(b+"/"+d+"/"+h+"/")+c+e+f+".jpg"}};b.client=new Client;b.angular=d.module("phomix",[]);b.angular.controller("header",["$scope",function(c){c.userMenu={mypageUrl:"#",userName:"",userImagePath:"/img/noimage_m_sq.jpg"};
b.client.handler.common={};b.client.handler.common.autoLogin=function(f){if(f&&f.userId){var d=a("#js-userMenu,#js-menu");c.$apply(function(){c.userMenu.mypageUrl="/u/"+f.userId+"/";c.userMenu.userName=f.name;c.userMenu.userImagePath=b.getImageUrl(f.imageId,b.Const.ImageType.SQUARE,b.Const.ImageSize.S)});d.show();var e=a(".dropdown");d.click(function(a){a.stopPropagation();e.is(":visible")||e.show()});a("body").click(function(){e.is(":visible")&&e.hide()})}}}]);window.App=b;a(function(){b.rollover();
(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();"#_=_"==window.location.hash&&(window.location.hash="");(function(){var c=false,b=a("#pagetop");b.css("bottom","-100px");c=false;a(window).scroll(function(){if(a(this).scrollTop()>100){if(c==false){c=true;b.stop().animate({bottom:"20px"},
200)}}else if(c){c=false;b.stop().animate({bottom:"-100px"},200)}});b.click(function(){a("body,html").animate({scrollTop:0},500);return false})})()})})(jQuery,angular);function Const(){this.SnsType={TWITTER:"1",FACEBOOK:"2"};this.ImageType={SQUARE:{suffix:"sq"},HD:{suffix:"hd"},SD:{suffix:"sd"}};this.ImageSize={M:{suffix:"m",size:400},L:{suffix:"l",size:700},S:{suffix:"s",size:200}}}"undefined"!==typeof window?App.Const=new Const:module.exports=new Const;var Handler=function(){};
Handler.prototype.invoke=function(a){try{var d=a.indexOf(":");if(0<d){var b=a.substr(0,d),c="";0<=b.indexOf(".")&&(c=b.substr(0,b.indexOf(".")),b=b.substr(b.indexOf(".")+1));var f=a.substr(d+1);eval("var obj = "+f);if("_"==b&&obj._req)(0,callbacks[obj._req])(obj);else{obj&&obj._req&&delete callbacks[obj._req];var g=c?this[c][b]:this[b];if(null==g)throw Error("no such method ["+a.substr(0,d)+"]");g(obj)}}}catch(e){e.stack?(App.client.showError(e.stack),console.log(e.stack)):(App.client.showError(e.message),
console.log(e.message))}};Handler.prototype.error=function(a){a.stack?App.client.showError(a.stack):a.message?App.client.showError(a.message):App.client.showError(a.name)};
